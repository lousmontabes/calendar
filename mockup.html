<!doctype html>

<html lang="en">

<head>
      <meta charset="utf-8">

      <title>Calendar</title>
      <meta name="description" content="Calendar">
      <meta name="author" content="Lluís Montabes">

      <link rel="stylesheet" href="styles/style.min.css">
      <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css?family=Varela+Round" rel="stylesheet">
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">

</head>

<body>

    <div id="curtain" onclick="hideMessage()">
        <div class="flying">
            <div class="modal centered" id="modal">
                <div class="section title" id="modal-title">
                    Caution
                </div>
                <div class="section message" id="modal-message">
                    Are you sure you want to permanently remove this event?
                </div>
                <div class="section buttons">
                    <div class="button caution" id="positive-button">
                        Remove event
                    </div>
                    <div class="button grey" id="negative-button">
                        Cancel
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="header">
        <div class="area title">
            <h1>Calendari de migracions</h1>
        </div>
    </div>

    <div class="area">

        <div class="section entry today">
            <h2><b>Today</b></h2>
            <div class="event" id="event1">
                <div class="buttons down">
                    <i class="far fa-edit"></i>
                    <i class="far fa-trash-alt caution" onclick="promptRemove('event1')"></i>
                </div>
                <div class="info">
                    10:00 - Juice
                    <div class="comments">
                        Cal copiar dades de l'usuari. Avisar a secretaria
                    </div>
                </div>
            </div>
            <div class="event" id="event2">
                <div class="buttons alt">
                    <i class="far fa-edit"></i>
                    <i class="far fa-trash-alt caution" onclick="promptRemove('event2')"></i>
                </div>
                <div class="info">
                    11:00 - Pedro
                    <div class="comments">
                        Enviat correu
                    </div>
                </div>
            </div>
            <div class="event last" id="event3">
                <div class="buttons alt">
                    <i class="far fa-edit"></i>
                    <i class="far fa-trash-alt caution" onclick="promptRemove('event3')"></i>
                </div>
                <div class="info">
                    12:00 - Vitor
                    <div class="comments">
                        La usuària vol que s'instal·li Office 2007, Skype, OpenOffice, Adobe CC, i tots els programes necessaris per a l'estudi de l'arquitectura aquífera.
                    </div>
                </div>
            </div>
        </div>

        <div class="section entry today">
            <h2><b>Tomorrow</b></h2>
            <div class="event last" id="event4">
                <div class="buttons alt">
                    <i class="far fa-edit"></i>
                    <i class="far fa-trash-alt caution" onclick="promptRemove('event4')"></i>
                </div>
                <div class="info">
                    12:00 - Vitor
                    <div class="comments">
                        Ordinador del taulell biblioteca GiH. Clonar amb imatge de biblioteques
                    </div>
                </div>
            </div>
        </div>

        <div class="new-entry from-below" id="new-entry-button">
            <div class="section new-entry-view">
                <i class="fas fa-plus-square"></i> New entry
            </div>
        </div>

    </div>

    <script
      src="https://code.jquery.com/jquery-3.3.1.min.js"
      integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
      crossorigin="anonymous"></script>

    <script>

        /* EVENT LISTENERS */

        /* Event buttons directional hover effect */

        $(".event").mouseenter(function(event) {

            var mouseY = event.pageY;
            var div = $(this);

            div.removeClass("slide-down-out");
            div.removeClass("slide-up-out");

            var distToTop = Math.abs(div.offset().top - mouseY);
            var distToBot = Math.abs(div.offset().top + div.outerHeight() - mouseY);

            if (distToTop < distToBot) {
                div.addClass("slide-down-in");
            } else {
                div.addClass("slide-up-in");
            }

        });

        $(".event").mouseleave(function(event) {

            var mouseY = event.pageY;
            var div = $(this);

            div.removeClass("slide-down-in");
            div.removeClass("slide-up-in");

            if (mouseY > div.offset().top) {
                div.addClass("slide-down-out");
            } else {
                div.addClass("slide-up-out");
            }

        });

        $("#modal").click(function(event) {
            event.stopPropagation();
        });

        /* GENERIC UI */

        /**
         *  Display a modal message with the defined text and actions
         */
        function showMessage(titleText,
            msgText,
            pButtonText,
            nButtonText,
            pButtonAction,
            nButtonAction,
            pButtonActionParams,
            nButtonActionParams) {

            var pButton = $("#positive-button");
            var nButton = $("#negative-button");

            $("#curtain").addClass("visible");
            $("#modal-title").html(titleText);
            $("#modal-message").html(msgText);

            pButton.html(pButtonText);
            pButton.off();
            pButton.click(function() {
                pButtonAction(pButtonActionParams);
                hideMessage();
            });

            nButton.html(nButtonText);
            nButton.off();
            nButton.click(function() {
                nButtonAction(nButtonActionParams);
                hideMessage();
            });
        }

        /**
         *  Hide current modal message
         */
        function hideMessage() {

            var pButton = $("#positive-button");
            var nButton = $("#negative-button");

            pButton.click(function() {
                doNothing();
            });

            nButton.click(function() {
                doNothing();
            });

            $("#curtain").removeClass("visible");
        }

        /**
         *  Fade out and remove specified event view
         */
        function removeEventView(eventId) {

            console.log(eventId);

            var eventView = $("#" + eventId);

            eventView.addClass("delete-item delayed");

            function hideView() {
                eventView.addClass("hidden");
                eventView.css("margin-top", -eventView.outerHeight());
            }

            setTimeout(hideView, 250);

        }

        /* UTILITY */

        /**
         *  Display modal message asking for event removal confirmation
         */
        function promptRemove(eventId) {

            var messageBody = "Are you sure you want to permanently remove this event?";
            messageBody += "<div class='event last'>" + $("#" + eventId).html() + "</div>";

            showMessage("Caution",
                messageBody,
                "Remove event",
                "Cancel",
                removeEventView,
                doNothing,
                eventId,
                null
            )
        }

        /*
         *  Does nothing.
         */
        function doNothing() {}

        /* FUNCTIONALITY */

        /**
         *  Remove event with specified id
         */
        function removeEvent(id) {
            //TODO: Implement during server development
        }

    </script>

</body>
</html>
