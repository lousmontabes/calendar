<!doctype html>

<html lang="en">

<head>
      <meta charset="utf-8">

      <title>Calendar</title>
      <meta name="description" content="Calendar">
      <meta name="author" content="Lluís Montabes">

      <link rel="stylesheet" href="styles/style.min.css">
      <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css?family=Varela+Round" rel="stylesheet">
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">

</head>

<body>

    <div class="template" id="new-event-form">
        <form>
            <div class="time-title">
                <input type="time" class="time" id="time-input"/>
                <input type="text" class="title" placeholder="Title of your event" spellcheck="false" />
            </div>
            <input type="text" class="comments" placeholder="Enter additional comments (optional)" spellcheck="false"/>
        </form>
    </div>
    <div class="curtain" id="modal-curtain" onclick="hideMessage()">
        <div class="flying">
            <div class="modal centered" id="modal">
                <div class="section title" id="modal-title">
                    Caution
                </div>
                <div class="section message" id="modal-message">
                    Are you sure you want to permanently remove this event?
                </div>
                <div class="section buttons">
                    <div class="button confirm" id="positive-button">
                        Remove event
                    </div>
                    <div class="button cancel" id="negative-button">
                        Cancel
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="bubble" id="time-picker">
        <div class="time-picker">
            <div class="column left" id="hour-column">
                <div class="spacer">

                </div>
                <div class="option" data-value="00">0</div>
                <div class="option" data-value="01">1</div>
                <div class="option" data-value="02">2</div>
                <div class="option" data-value="03">3</div>
                <div class="option" data-value="04">4</div>
                <div class="option" data-value="05">5</div>
                <div class="option" data-value="06">6</div>
                <div class="option" data-value="07">7</div>
                <div class="option" data-value="08">8</div>
                <div class="option" data-value="09">9</div>
                <div class="option" data-value="10">10</div>
                <div class="option" data-value="11">11</div>
                <div class="option" data-value="12">12</div>
                <div class="option" data-value="13">13</div>
                <div class="option" data-value="14">14</div>
                <div class="option" data-value="15">15</div>
                <div class="option" data-value="16">16</div>
                <div class="option" data-value="17">17</div>
                <div class="option" data-value="18">18</div>
                <div class="option" data-value="19">19</div>
                <div class="option" data-value="20">20</div>
                <div class="option" data-value="21">21</div>
                <div class="option" data-value="22">22</div>
                <div class="option" data-value="23">23</div>
                <div class="spacer">

                </div>
            </div><div class="column" id="minute-column">
                <div class="spacer">

                </div>
                <div class="option" data-value="00">00</div>
                <div class="option" data-value="05">05</div>
                <div class="option" data-value="10">10</div>
                <div class="option" data-value="15">15</div>
                <div class="option" data-value="20">20</div>
                <div class="option" data-value="25">25</div>
                <div class="option" data-value="30">30</div>
                <div class="option" data-value="35">35</div>
                <div class="option" data-value="40">40</div>
                <div class="option" data-value="45">45</div>
                <div class="option" data-value="50">50</div>
                <div class="option" data-value="55">55</div>
                <div class="spacer">

                </div>
            </div>
        </div>
    </div>

    <div class="header">
        <div class="area title">
            <h1>Calendari de migracions</h1>
        </div>
    </div>

    <div class="area">

        <div class="entry" id="entry1">

            <div class="entry-header">
                <h2>Today</h2>
            </div>

            <div class="event-wrap">
                <div class="event" id="event1">
                    <div class="buttons down">
                        <i class="far fa-edit"></i>
                        <i class="far fa-trash-alt caution" onclick="promptRemove('event1')"></i>
                    </div>
                    <div class="info">
                        10:00 - Juice
                        <div class="comments">
                            Cal copiar dades de l'usuari. Avisar a secretaria
                        </div>
                    </div>
                </div>
            </div>

            <div class="event-wrap">
                <div class="event" id="event2">
                    <div class="buttons alt">
                        <i class="far fa-edit"></i>
                        <i class="far fa-trash-alt caution" onclick="promptRemove('event2')"></i>
                    </div>
                    <div class="info">
                        11:00 - Pedro
                        <div class="comments">
                            Enviat correu
                        </div>
                    </div>
                </div>
            </div>

            <div class="event-wrap">
                <div class="event last" id="event3">
                    <div class="buttons alt">
                        <i class="far fa-edit"></i>
                        <i class="far fa-trash-alt caution" onclick="promptRemove('event3')"></i>
                    </div>
                    <div class="info">
                        12:00 - Vitor
                        <div class="comments">
                            La usuària vol que s'instal·li Office 2007, Skype, OpenOffice, Adobe CC, i tots els programes necessaris per a l'estudi de l'arquitectura aquífera.
                        </div>
                    </div>
                </div>
            </div>

            <div class="event-wrap clickable" onclick="promptAdd('entry1')">
                <div class="add-event">
                    <i class="fas fa-plus-square"></i> New event
                </div>
            </div>

        </div>

        <div class="entry" id="entry2">

            <div class="entry-header">
                <h2>Tomorrow</h2>
            </div>

            <div class="event-wrap">
                <div class="event last" id="event4">
                    <div class="buttons alt">
                        <i class="far fa-edit"></i>
                        <i class="far fa-trash-alt caution" onclick="promptRemove('event4')"></i>
                    </div>
                    <div class="info">
                        12:00 - Vitor
                        <div class="comments">
                            Ordinador del taulell biblioteca GiH. Clonar amb imatge de biblioteques
                        </div>
                    </div>
                </div>
            </div>

            <div class="event-wrap clickable" onclick="promptAdd('entry2')">
                <div class="add-event">
                    <i class="fas fa-plus-square"></i> New event
                </div>
            </div>
        </div>

        <div class="entry empty" id="new-entry">

            <div class="entry-header">
                <h2>Wednesday</h2>
            </div>

            <div class="event-wrap clickable" onclick="promptAdd('entry2')">
                <div class="add-event">
                    <i class="fas fa-plus-square"></i> New event
                </div>
            </div>
        </div>

    </div>

    <script
        src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>

    <script src="./scripts/time-picker.js"></script>

    <script>

        var MessageType = {
            NEUTRAL: 1,
            NEGATIVE: 2,
            POSITIVE: 3,
            assignedClass: {
                1: "neutral",
                2: "negative",
                3: "positive"
            }
        };

        /* EVENT LISTENERS */

        /* Event buttons directional hover effect */

        $(".event-wrap").mouseenter(function(event) {

            var mouseY = event.pageY;
            var div = $(this);

            div.removeClass("slide-down-out");
            div.removeClass("slide-up-out");

            var distToTop = Math.abs(div.offset().top - mouseY);
            var distToBot = Math.abs(div.offset().top + div.outerHeight() - mouseY);

            if (distToTop < distToBot) {
                div.addClass("slide-down-in");
            } else {
                div.addClass("slide-up-in");
            }

        });

        $(".event-wrap").mouseleave(function(event) {

            var mouseY = event.pageY;
            var div = $(this);

            div.removeClass("slide-down-in");
            div.removeClass("slide-up-in");

            if (mouseY > div.offset().top) {
                div.addClass("slide-down-out");
            } else {
                div.addClass("slide-up-out");
            }

        });

        $("#modal").click(function(event) {
            event.stopPropagation();
        });

        $("#modal").keypress(function(e) {
            var key = e.keyCode;

            if (key == 13) {
                // Enter key pressed
                $("#modal #positive-button").click();
            }

        });

        /* GENERIC UI */

        /**
         *  Display a modal message with the defined text and actions
         */
        function showMessage(
            type,
            titleText,
            msgText,
            pButtonText,
            nButtonText,
            pButtonAction,
            nButtonAction,
            pButtonActionParams,
            nButtonActionParams) {

            var pButton = $("#positive-button");
            var nButton = $("#negative-button");

            $("body").addClass("no-scroll");
            $("#modal-curtain").addClass("visible dark");
            $("#modal-title").html(titleText);
            $("#modal-message").html(msgText);

            $("#modal").removeClass("neutral");
            $("#modal").removeClass("negative");
            $("#modal").removeClass("positive");

            $("#modal").addClass(MessageType.assignedClass[type]);

            pButton.html(pButtonText);
            pButton.off();
            pButton.click(function() {
                pButtonAction(pButtonActionParams);
                hideMessage();
            });

            nButton.html(nButtonText);
            nButton.off();
            nButton.click(function() {
                nButtonAction(nButtonActionParams);
                hideMessage();
            });
        }

        /**
         *  Hide current modal message
         */
        function hideMessage() {

            var pButton = $("#positive-button");
            var nButton = $("#negative-button");

            pButton.click(function() {
                doNothing();
            });

            nButton.click(function() {
                doNothing();
            });

            $("#modal-curtain").removeClass("visible dark");
            $("body").removeClass("no-scroll");
            setTimeout(function() {
                activeTimePicker.resetView();
            }, 100);
        }

        /**
         *  Fade out and remove specified event view
         */
        function removeEventView(eventId) {

            var eventView = $("#" + eventId);

            eventView.addClass("delete-item delayed");

            function hideView() {
                eventView.addClass("hidden");
                eventView.css("margin-top", -eventView.outerHeight());
            }

            setTimeout(hideView, 250);

        }

        /**
         *  Show time picker
         */
        $("#modal").on('click', '#time-input', function(event) {
            activeTimePicker = new TimePicker($("#modal #time-input"), "00", "00");
            activeTimePicker.show();
            event.stopPropagation();
        });

        $(".curtain").on('click', function(event) {
            activeTimePicker.hide();
        });

        $("#modal").on('click', function(event) {
            activeTimePicker.hide();
        });

        /**
         *  Hide time picker
         */
        function hideTimePicker() {
            activeTimePicker.hide();
        }

        /* UTILITY */

        /**
         *  Display modal message asking for event removal confirmation
         */
        function promptRemove(eventId) {

            var messageTitle = "Are you sure you want to permanently remove this event?";
            var messageBody = "<div class='event last'>" + $("#" + eventId).html() + "</div>";

            showMessage(
                MessageType.NEGATIVE,
                messageTitle,
                messageBody,
                "Remove event",
                "Cancel",
                removeEventView,
                doNothing,
                eventId,
                null
            )
        }

        /**
         *  Display modal message asking for new event data
         */
        function promptAdd(entryId) {

            var messageTitle = "Enter event information";
            var messageBody = $("#new-event-form").html();

            showMessage(
                MessageType.POSITIVE,
                messageTitle,
                messageBody,
                "Add event",
                "Cancel",
                doNothing,
                doNothing,
                null,
                null
            )

            setTimeout('$("#modal #time-input").focus(); $("#modal #time-input").click()', 110);

        }

        /*
         *  Does nothing.
         */
        function doNothing() {}

        /* FUNCTIONALITY */

        /**
         *  Remove event with specified id
         */
        function removeEvent(id) {
            //TODO: Implement during server development
        }

    </script>

</body>
</html>
